(()=>{"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===_typeof(i)?i:String(i)),n)}var o,i}var e=function(){function Api(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Api),this.baseUrl=e,this.options={headers:Object.assign({"Content-Type":"application/json"},null!==(t=r.headers)&&void 0!==t?t:{})}}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(Api,[{key:"handleResponse",value:function handleResponse(e){return e.ok?e.json():e.json().then((function(t){var r;return Promise.reject(null!==(r=t.error)&&void 0!==r?r:e.statusText)}))}},{key:"get",value:function get(e){return fetch(this.baseUrl+e,Object.assign(Object.assign({},this.options),{method:"GET"})).then(this.handleResponse)}},{key:"post",value:function post(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST";return fetch(this.baseUrl+e,Object.assign(Object.assign({},this.options),{method:r,body:JSON.stringify(t)})).then(this.handleResponse)}}]),Api}();function events_typeof(e){return events_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},events_typeof(e)}function events_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function events_toPrimitive(e,t){if("object"!==events_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==events_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===events_typeof(i)?i:String(i)),n)}var o,i}var t=function(){function EventEmitter(){!function events_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,EventEmitter),this._events=new Map}return function events_createClass(e,t,r){return t&&events_defineProperties(e.prototype,t),r&&events_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(EventEmitter,[{key:"on",value:function on(e,t){var r;this._events.has(e)||this._events.set(e,new Set),null===(r=this._events.get(e))||void 0===r||r.add(t)}},{key:"off",value:function off(e,t){var r;this._events.has(e)&&(this._events.get(e).delete(t),0===(null===(r=this._events.get(e))||void 0===r?void 0:r.size)&&this._events.delete(e))}},{key:"emit",value:function emit(e,t){this._events.forEach((function(r,n){"*"===n&&r.forEach((function(r){return r({eventName:e,data:t})})),(n instanceof RegExp&&n.test(e)||n===e)&&r.forEach((function(e){return e(t)}))}))}},{key:"onAll",value:function onAll(e){this.on("*",e)}},{key:"offAll",value:function offAll(){this._events=new Map}},{key:"trigger",value:function trigger(e,t){var r=this;return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.emit(e,Object.assign(Object.assign({},n||{}),t||{}))}}}]),EventEmitter}();function isSelector(e){return"string"==typeof e&&e.length>1}function ensureAllElements(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;if(isSelector(e))return Array.from(t.querySelectorAll(e));if(e instanceof NodeList)return Array.from(e);if(Array.isArray(e))return e;throw new Error("Unknown selector element")}function ensureElement(e,t){if(isSelector(e)){var r=ensureAllElements(e,t);if(r.length>1&&console.warn("selector ".concat(e," return more then one element")),0===r.length)throw new Error("selector ".concat(e," return nothing"));return r.pop()}if(e instanceof HTMLElement)return e;throw new Error("Unknown selector element")}function cloneTemplate(e){return ensureElement(e).content.firstElementChild.cloneNode(!0)}function Component_typeof(e){return Component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Component_typeof(e)}function Component_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function Component_toPrimitive(e,t){if("object"!==Component_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Component_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===Component_typeof(i)?i:String(i)),n)}var o,i}var r=function(){function Component(e){!function Component_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Component),this.container=e}return function Component_createClass(e,t,r){return t&&Component_defineProperties(e.prototype,t),r&&Component_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(Component,[{key:"setText",value:function setText(e,t){e.textContent=t}},{key:"setImage",value:function setImage(e,t,r){e.src=t,e.alt=r}},{key:"setDisabled",value:function setDisabled(e,t){t?e.setAttribute("disabled","true"):e.removeAttribute("disabled")}},{key:"toggleClass",value:function toggleClass(e,t,r){r?e.classList.add(t):e.classList.remove(t)}}]),Component}();function Basket_typeof(e){return Basket_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Basket_typeof(e)}function Basket_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function Basket_toPrimitive(e,t){if("object"!==Basket_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Basket_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===Basket_typeof(i)?i:String(i)),n)}var o,i}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function _possibleConstructorReturn(e,t){if(t&&("object"===Basket_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}var n=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}(Basket,e);var t=_createSuper(Basket);function Basket(e,r){var n;return function Basket_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Basket),(n=t.call(this,e)).events=r,n.itemlist=ensureElement(".basket__list",n.container),n.totalprice=ensureElement(".basket__price",n.container),n.orderbutton=ensureElement(".button",n.container),n.orderbutton.addEventListener("click",(function(){n.events.emit("order:open")})),n}return function Basket_createClass(e,t,r){return t&&Basket_defineProperties(e.prototype,t),r&&Basket_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(Basket,[{key:"createBasketItem",value:function createBasketItem(e){var t=this,r=cloneTemplate(ensureElement("#card-basket")),n=ensureElement(".card__title",r),o=ensureElement(".card__price",r),i=ensureElement(".basket__item-delete",r),s=ensureElement(".basket__item-index",r);return n.textContent=e.product.title,o.textContent="".concat(e.product.price," синапсов"),s.textContent="".concat(e.index),i.addEventListener("click",(function(){t.events.emit("basket:remove",{productId:e.product.id})})),r}},{key:"render",value:function render(e,t){var r=this;this.itemlist.innerHTML="",e.forEach((function(e){var t=r.createBasketItem(e);r.itemlist.appendChild(t)})),this.totalprice.textContent="".concat(t," синапсов"),0===e.length?(this.orderbutton.classList.add("button__disabled"),this.orderbutton.disabled=!0):(this.orderbutton.classList.remove("button__disabled"),this.orderbutton.disabled=!1)}}]),Basket}(r),o={"софт-скил":"soft",другое:"other",дополнительное:"additional",кнопка:"button","хард-скил":"hard"};function Card_typeof(e){return Card_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Card_typeof(e)}function Card_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function Card_toPrimitive(e,t){if("object"!==Card_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Card_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===Card_typeof(i)?i:String(i)),n)}var o,i}function Card_setPrototypeOf(e,t){return Card_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e},Card_setPrototypeOf(e,t)}function Card_createSuper(e){var t=function Card_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=Card_getPrototypeOf(e);if(t){var o=Card_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function Card_possibleConstructorReturn(e,t){if(t&&("object"===Card_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function Card_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Card_getPrototypeOf(e){return Card_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},Card_getPrototypeOf(e)}var i=function(e){!function Card_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Card_setPrototypeOf(e,t)}(Card,e);var t=Card_createSuper(Card);function Card(e,r){var n;return function Card_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Card),(n=t.call(this,e)).events=r,n.title=ensureElement(".card__title",n.container),n.price=ensureElement(".card__price",n.container),n.image=ensureElement(".card__image",n.container),n.category=ensureElement(".card__category",n.container),n}return function Card_createClass(e,t,r){return t&&Card_defineProperties(e.prototype,t),r&&Card_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(Card,[{key:"render",value:function render(e){var t=this;this.title.textContent=e.title,null===e.price?this.price.textContent="Бесценно":this.price.textContent="".concat(e.price," синапсов"),this.image.src=e.image,this.category.textContent=e.category;var r=o[e.category]||"other";this.category.className="card__category card__category_".concat(r),this.container.addEventListener("click",(function(){t.events.emit("card:click",{productId:e.id})}))}}]),Card}(r);function Form_typeof(e){return Form_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Form_typeof(e)}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return Form_arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function Form_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return Form_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Form_arrayLikeToArray(e,t)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Form_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Form_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function Form_toPrimitive(e,t){if("object"!==Form_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Form_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===Form_typeof(i)?i:String(i)),n)}var o,i}function Form_setPrototypeOf(e,t){return Form_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e},Form_setPrototypeOf(e,t)}function Form_createSuper(e){var t=function Form_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=Form_getPrototypeOf(e);if(t){var o=Form_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function Form_possibleConstructorReturn(e,t){if(t&&("object"===Form_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function Form_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Form_getPrototypeOf(e){return Form_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},Form_getPrototypeOf(e)}var s=function(e){!function Form_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Form_setPrototypeOf(e,t)}(FormComponent,e);var t=Form_createSuper(FormComponent);function FormComponent(e){var r;return function Form_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FormComponent),(r=t.call(this,e)).inputList=ensureAllElements(".form__input",r.container),r.submitButton=ensureElement('button[type="submit"]',r.container),r.errorsContainer=ensureElement(".form__errors",r.container),r}return function Form_createClass(e,t,r){return t&&Form_defineProperties(e.prototype,t),r&&Form_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(FormComponent,[{key:"render",value:function render(){return this.hideErrors(),this.validateForm(),this.container}},{key:"setSubmitHandler",value:function setSubmitHandler(e){var t=this;this.container.addEventListener("submit",(function(r){t.validateForm()?e(r):r.preventDefault()}))}},{key:"validateForm",value:function validateForm(){var e=this.validateSpecific(),t=this.validateInputs(),r=[].concat(_toConsumableArray(e),_toConsumableArray(t)),n=0===r.length;return this.submitButton.disabled=!n,r.length>0?this.showErrors(r):this.hideErrors(),n}},{key:"validateInputs",value:function validateInputs(){var e=this,t=[];return this.getInputs().forEach((function(r){if(""===r.value.trim()||!r.validity.valid){var n=e.getCustomErrorMessage(r);t.push(n||r.validationMessage)}})),t}},{key:"getCustomErrorMessage",value:function getCustomErrorMessage(e){return{address:"Необходимо указать адрес",phone:"Укажите номер телефона в формате +7 (XXX) XXX-XX-XX",email:"Укажите email в формате example@mail.com"}[e.name]||null}},{key:"showErrors",value:function showErrors(e){this.errorsContainer.textContent=e.join(" "),this.errorsContainer.style.display="block"}},{key:"hideErrors",value:function hideErrors(){this.errorsContainer.textContent="",this.errorsContainer.style.display="none"}}]),FormComponent}(r);function ContactsForm_typeof(e){return ContactsForm_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ContactsForm_typeof(e)}function ContactsForm_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function ContactsForm_toPrimitive(e,t){if("object"!==ContactsForm_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ContactsForm_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===ContactsForm_typeof(i)?i:String(i)),n)}var o,i}function ContactsForm_setPrototypeOf(e,t){return ContactsForm_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e},ContactsForm_setPrototypeOf(e,t)}function ContactsForm_createSuper(e){var t=function ContactsForm_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=ContactsForm_getPrototypeOf(e);if(t){var o=ContactsForm_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function ContactsForm_possibleConstructorReturn(e,t){if(t&&("object"===ContactsForm_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function ContactsForm_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function ContactsForm_getPrototypeOf(e){return ContactsForm_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},ContactsForm_getPrototypeOf(e)}var c=function(e){!function ContactsForm_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ContactsForm_setPrototypeOf(e,t)}(ContactsForm,e);var t=ContactsForm_createSuper(ContactsForm);function ContactsForm(e){return function ContactsForm_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ContactsForm),t.call(this,e)}return function ContactsForm_createClass(e,t,r){return t&&ContactsForm_defineProperties(e.prototype,t),r&&ContactsForm_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(ContactsForm,[{key:"getInputs",value:function getInputs(){return this.emailInput&&this.phoneInput?[this.emailInput,this.phoneInput]:[]}},{key:"validateSpecific",value:function validateSpecific(){return[]}},{key:"render",value:function render(){return this.emailInput=ensureElement('input[name="email"]',this.container),this.phoneInput=ensureElement('input[name="phone"]',this.container),this.submitButton=ensureElement('button[type="submit"]',this.container),this.errorsContainer=ensureElement(".form__errors",this.container),this.setupPhoneMask(),this.setupValidation(),this.emailInput.value="",this.phoneInput.value="",this.validateForm(),this.hideErrors(),this.container}},{key:"setupPhoneMask",value:function setupPhoneMask(){var e=this;this.phoneInput.addEventListener("input",(function(t){var r=t.target,n=r.value.replace(/\D/g,""),o=e.formatPhone(n);r.value=o,e.validateForm()}))}},{key:"setupValidation",value:function setupValidation(){var e=this;this.container.addEventListener("input",(function(){return e.validateForm()}))}},{key:"formatPhone",value:function formatPhone(e){var t=e.startsWith("7")?e.slice(1):e;return 0===t.length?"+7":t.length<=3?"+7 (".concat(t):t.length<=6?"+7 (".concat(t.slice(0,3),") ").concat(t.slice(3)):t.length<=8?"+7 (".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):"+7 (".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6,8),"-").concat(t.slice(8,10))}},{key:"getValues",value:function getValues(){return this.emailInput&&this.phoneInput?{email:this.emailInput.value.trim(),phone:this.phoneInput.value.trim()}:{email:"",phone:""}}}]),ContactsForm}(s);function Modal_typeof(e){return Modal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Modal_typeof(e)}function Modal_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function Modal_toPrimitive(e,t){if("object"!==Modal_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Modal_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===Modal_typeof(i)?i:String(i)),n)}var o,i}function Modal_setPrototypeOf(e,t){return Modal_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e},Modal_setPrototypeOf(e,t)}function Modal_createSuper(e){var t=function Modal_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=Modal_getPrototypeOf(e);if(t){var o=Modal_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function Modal_possibleConstructorReturn(e,t){if(t&&("object"===Modal_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function Modal_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Modal_getPrototypeOf(e){return Modal_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},Modal_getPrototypeOf(e)}var a=function(e){!function Modal_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Modal_setPrototypeOf(e,t)}(Modal,e);var t=Modal_createSuper(Modal);function Modal(e){var r;return function Modal_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Modal),(r=t.call(this,e)).closeButton=ensureElement(".modal__close",r.container),r.closeButton.addEventListener("click",(function(){return r.close()})),r.container.addEventListener("click",(function(e){return r.handleOutsideClick(e)})),r}return function Modal_createClass(e,t,r){return t&&Modal_defineProperties(e.prototype,t),r&&Modal_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(Modal,[{key:"open",value:function open(){this.container.classList.add("modal_active")}},{key:"close",value:function close(){this.container.classList.remove("modal_active")}},{key:"setContent",value:function setContent(e){var t=ensureElement(".modal__content",this.container);return t.innerHTML="",t.appendChild(e),this}},{key:"handleOutsideClick",value:function handleOutsideClick(e){e.target===this.container&&this.close()}}]),Modal}(r);function OrderForm_typeof(e){return OrderForm_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},OrderForm_typeof(e)}function OrderForm_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function OrderForm_toPrimitive(e,t){if("object"!==OrderForm_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==OrderForm_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===OrderForm_typeof(i)?i:String(i)),n)}var o,i}function OrderForm_setPrototypeOf(e,t){return OrderForm_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e},OrderForm_setPrototypeOf(e,t)}function OrderForm_createSuper(e){var t=function OrderForm_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=OrderForm_getPrototypeOf(e);if(t){var o=OrderForm_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function OrderForm_possibleConstructorReturn(e,t){if(t&&("object"===OrderForm_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function OrderForm_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function OrderForm_getPrototypeOf(e){return OrderForm_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},OrderForm_getPrototypeOf(e)}var u=function(e){!function OrderForm_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OrderForm_setPrototypeOf(e,t)}(OrderForm,e);var t=OrderForm_createSuper(OrderForm);function OrderForm(e){return function OrderForm_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,OrderForm),t.call(this,e)}return function OrderForm_createClass(e,t,r){return t&&OrderForm_defineProperties(e.prototype,t),r&&OrderForm_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(OrderForm,[{key:"getInputs",value:function getInputs(){return this.addressInput?[this.addressInput]:[]}},{key:"validateSpecific",value:function validateSpecific(){var e=[];return this.paymentButtons?(Array.from(this.paymentButtons).some((function(e){return e.classList.contains("button_active")}))||e.push("Выберите способ оплаты"),e):(e.push("Выберите способ оплаты"),e)}},{key:"render",value:function render(){return this.submitButton=ensureElement('button[type="submit"]',this.container),this.errorsContainer=ensureElement(".form__errors",this.container),this.paymentButtons=this.container.querySelectorAll(".button_alt"),this.addressInput=ensureElement('input[name="address"]',this.container),this.setupValidation(),this.addressInput.value="",this.paymentButtons.forEach((function(e){e.classList.remove("button_active"),e.classList.remove("button_alt-active")})),this.validateForm(),this.hideErrors(),this.container}},{key:"setPaymentHandler",value:function setPaymentHandler(e){var t=this;this.paymentButtons||(this.paymentButtons=this.container.querySelectorAll(".button_alt")),this.paymentButtons.forEach((function(r){r.addEventListener("click",(function(){t.paymentButtons.forEach((function(e){e.classList.remove("button_active"),e.classList.remove("button_alt-active")})),r.classList.add("button_active"),r.classList.add("button_alt-active"),e(r.name),t.validateForm()}))}))}},{key:"setAddressHandler",value:function setAddressHandler(e){var t=this;this.addressInput||(this.addressInput=ensureElement('input[name="address"]',this.container)),this.addressInput.addEventListener("input",(function(){e(t.addressInput.value),t.validateForm()}))}},{key:"setupValidation",value:function setupValidation(){var e=this;this.addressInput||(this.addressInput=ensureElement('input[name="address"]',this.container)),this.addressInput.addEventListener("input",(function(){return e.validateForm()}))}},{key:"getValues",value:function getValues(){var e;return this.paymentButtons&&this.addressInput?{payment:null===(e=Array.from(this.paymentButtons).find((function(e){return e.classList.contains("button_active")})))||void 0===e?void 0:e.name,address:this.addressInput.value.trim()}:{payment:void 0,address:""}}}]),OrderForm}(s);function ProductPreview_typeof(e){return ProductPreview_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ProductPreview_typeof(e)}function ProductPreview_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function ProductPreview_toPrimitive(e,t){if("object"!==ProductPreview_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ProductPreview_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===ProductPreview_typeof(i)?i:String(i)),n)}var o,i}function ProductPreview_setPrototypeOf(e,t){return ProductPreview_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e},ProductPreview_setPrototypeOf(e,t)}function ProductPreview_createSuper(e){var t=function ProductPreview_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=ProductPreview_getPrototypeOf(e);if(t){var o=ProductPreview_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function ProductPreview_possibleConstructorReturn(e,t){if(t&&("object"===ProductPreview_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function ProductPreview_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function ProductPreview_getPrototypeOf(e){return ProductPreview_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},ProductPreview_getPrototypeOf(e)}var l=function(e){!function ProductPreview_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ProductPreview_setPrototypeOf(e,t)}(ProductPreview,e);var t=ProductPreview_createSuper(ProductPreview);function ProductPreview(e){var r;return function ProductPreview_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ProductPreview),(r=t.call(this,e)).title=ensureElement(".card__title",r.container),r.description=ensureElement(".card__text",r.container),r.price=ensureElement(".card__price",r.container),r.image=ensureElement(".card__image",r.container),r.category=ensureElement(".card__category",r.container),r.button=ensureElement(".card__button",r.container),r}return function ProductPreview_createClass(e,t,r){return t&&ProductPreview_defineProperties(e.prototype,t),r&&ProductPreview_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(ProductPreview,[{key:"render",value:function render(e,t){this.title.textContent=e.title,this.description.textContent=e.description,this.image.src=e.image,null===e.price?(this.price.textContent="Бесценно",this.button.textContent="Недоступно",this.button.disabled=!0,this.button.classList.add("button__disabled")):(this.price.textContent="".concat(e.price," синапсов"),this.button.textContent=t?"Удалить из корзины":"В корзину",this.button.disabled=!1,this.button.classList.remove("button__disabled")),this.category.textContent=e.category;var r=o[e.category]||"other";return this.category.className="card__category card__category_".concat(r),this.container}},{key:"setButtonHandler",value:function setButtonHandler(e){var t=this;this.button.addEventListener("click",(function(){var r="В корзину"===t.button.textContent;e(r)}))}}]),ProductPreview}(r),f="".concat("https://larek-api.nomoreparties.co","/api/weblarek"),p="".concat("https://larek-api.nomoreparties.co","/content/weblarek");function SuccessMessage_typeof(e){return SuccessMessage_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},SuccessMessage_typeof(e)}function SuccessMessage_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function SuccessMessage_toPrimitive(e,t){if("object"!==SuccessMessage_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==SuccessMessage_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===SuccessMessage_typeof(i)?i:String(i)),n)}var o,i}function SuccessMessage_setPrototypeOf(e,t){return SuccessMessage_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(e,t){return e.__proto__=t,e},SuccessMessage_setPrototypeOf(e,t)}function SuccessMessage_createSuper(e){var t=function SuccessMessage_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=SuccessMessage_getPrototypeOf(e);if(t){var o=SuccessMessage_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function SuccessMessage_possibleConstructorReturn(e,t){if(t&&("object"===SuccessMessage_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function SuccessMessage_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function SuccessMessage_getPrototypeOf(e){return SuccessMessage_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},SuccessMessage_getPrototypeOf(e)}var y=function(e){!function SuccessMessage_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&SuccessMessage_setPrototypeOf(e,t)}(SuccessMessage,e);var t=SuccessMessage_createSuper(SuccessMessage);function SuccessMessage(e){var r;return function SuccessMessage_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SuccessMessage),(r=t.call(this,e)).title=ensureElement(".order-success__title",r.container),r.description=ensureElement(".order-success__description",r.container),r.closeButton=ensureElement(".order-success__close",r.container),r}return function SuccessMessage_createClass(e,t,r){return t&&SuccessMessage_defineProperties(e.prototype,t),r&&SuccessMessage_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(SuccessMessage,[{key:"render",value:function render(e){return this.description.textContent="Списано ".concat(e.total," синапсов"),this.container}},{key:"setCloseHandler",value:function setCloseHandler(e){this.closeButton.addEventListener("click",e)}}]),SuccessMessage}(r),d=new t,m=new e(f),v=[],b=[],_=ensureElement(".gallery"),h=ensureAllElements(".modal"),P=new a(h[0]),g=new a(h[1]),O=new a(h[2]),C=new a(h[4]),w=ensureElement(".header__basket-counter"),S=ensureElement(".basket"),E=ensureElement(".header__basket"),j=new n(S,d);m.get("/product").then((function(e){(v=e.items.map((function(e){return Object.assign(Object.assign({},e),{image:p+e.image})}))).forEach((function(e){var t=cloneTemplate(ensureElement("#card-catalog"));new i(t,d).render(e),_.appendChild(t)}))})),d.on("card:click",(function(e){var t=v.find((function(t){return t.id===e.productId}));if(t){var r=cloneTemplate(ensureElement("#card-preview")),n=b.some((function(e){return e.product.id===t.id})),o=new l(r);o.render(t,n),o.setButtonHandler((function(e){e?d.emit("basket:add",{productId:t.id}):d.emit("basket:remove",{productId:t.id}),P.close()})),P.setContent(r).open()}})),d.on("basket:add",(function(e){var t=v.find((function(t){return t.id===e.productId}));if(t){b.push({product:t,index:b.length+1});var r=b.reduce((function(e,t){return e+t.product.price}),0);j.render(b,r),w.textContent="".concat(b.length),P.close()}})),d.on("basket:remove",(function(e){var t=(b=b.filter((function(t){return t.product.id!==e.productId}))).reduce((function(e,t){return e+t.product.price}),0);j.render(b,t),w.textContent="".concat(b.length)})),d.on("order:open",(function(){var e=cloneTemplate(ensureElement("#order")),t=new u(e);t.render(),t.setPaymentHandler((function(e){console.log("Payment method:",e)})),t.setAddressHandler((function(e){console.log("Address:",e)})),t.setSubmitHandler((function(e){e.preventDefault();var r=t.getValues(),n=cloneTemplate(ensureElement("#contacts")),o=new c(n);o.render(),o.setSubmitHandler((function(e){e.preventDefault();var t=o.getValues(),n={payment:r.payment,address:r.address,email:t.email,phone:t.phone,total:b.reduce((function(e,t){return e+t.product.price}),0),items:b.map((function(e){return e.product.id}))};m.post("/order",n).then((function(e){console.log("Order success:",e),d.emit("order:success",{total:e.total})})).catch((function(e){console.error("Order error:",e.error)}))})),O.setContent(n)})),O.setContent(e).open(),g.close()})),d.on("order:success",(function(e){var t=cloneTemplate(ensureElement("#success")),r=new y(t);r.render({total:e.total}),C.setContent(t).open(),O.close(),b=[],w.textContent="0",r.setCloseHandler((function(){C.close()}))})),E.addEventListener("click",(function(){var e=b.reduce((function(e,t){return e+t.product.price}),0);j.render(b,e),g.setContent(S).open()}))})();
//# sourceMappingURL=main.js.map